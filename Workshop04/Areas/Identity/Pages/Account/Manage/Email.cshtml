@page
@model EmailModel
@{
    ViewData["Title"] = "Manage Email";
    ViewData["ActivePage"] = ManageNavPages.Email;
}

<div class="card">
    <div class="card-header" style="padding: 2rem;">
        <h3 style="font-family: var(--te-heading-font); color: var(--te-cream); margin: 0; font-size: 1.75rem;">
            <i class="fas fa-envelope me-2"></i>Email
        </h3>
    </div>
    <div class="card-body" style="padding: 3rem;">
        <partial name="_StatusMessage" for="StatusMessage" />

        <form id="email-form" method="post">
            <div asp-validation-summary="All" class="text-danger" role="alert" style="margin-bottom: 2rem;"></div>

            <div class="form-group" style="margin-bottom: 2rem;">
                <label asp-for="Email" style="display: block; margin-bottom: 0.75rem; color: var(--te-deep-navy); font-weight: 500; letter-spacing: 0.5px; text-transform: uppercase; font-size: 0.9rem;">Current Email</label>
                <input asp-for="Email" class="form-control" disabled style="background-color: #f5f5f5; cursor: not-allowed; padding: 1rem; font-size: 1rem;" />
                <small style="color: var(--te-soft-gray); margin-top: 0.5rem; display: block; font-size: 0.85rem;">
                    <i class="fas fa-info-circle"></i> Your current email address
                </small>
            </div>

            <div class="form-group" style="margin-bottom: 2.5rem;">
                <label asp-for="Input.NewEmail" style="display: block; margin-bottom: 0.75rem; color: var(--te-deep-navy); font-weight: 500; letter-spacing: 0.5px; text-transform: uppercase; font-size: 0.9rem;">New Email</label>
                <input asp-for="Input.NewEmail" class="form-control" autocomplete="email" aria-required="true" placeholder="Enter your new email address" id="new-email-input" style="padding: 1rem; font-size: 1rem;" />
                <span asp-validation-for="Input.NewEmail" class="text-danger" style="margin-top: 0.5rem; display: block; font-size: 0.9rem;"></span>
                <small style="color: var(--te-soft-gray); margin-top: 0.5rem; display: block; font-size: 0.85rem;">
                    <i class="fas fa-exclamation-triangle"></i> This will also update your login username
                </small>
            </div>

            <div style="padding-top: 1rem; border-top: 2px solid #E5E0D8;">
                <button id="change-email-button" type="submit" asp-page-handler="ChangeEmail" class="btn btn-primary btn-lg" style="padding: 1rem 3rem; font-size: 1rem;">
                    <i class="fas fa-save me-2"></i> Change Email
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Email change confirmation
        const form = document.getElementById('email-form');
        const newEmailInput = document.getElementById('new-email-input');
        const currentEmail = '@Model.Email';

        form.addEventListener('submit', function(e) {
            const newEmail = newEmailInput.value;
            
            if (newEmail !== currentEmail && newEmail.trim() !== '') {
                if (!confirm('Are you sure you want to change your email address?\n\nNew email: ' + newEmail + '\n\nThis will also change your login username.')) {
                    e.preventDefault();
                    return false;
                }
            }
        });
    </script>
}